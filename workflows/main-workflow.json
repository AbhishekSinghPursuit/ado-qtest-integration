{
  "name": "ADO User Story webhook",
  "nodes": [
    {
      "parameters": {
        "content": "# Azure DevOps → qTest Integration\n\n**Purpose:** Sync ADO work items to qTest requirements.\n**Triggers:** workitem.created, workitem.updated, workitem.deleted\n**Flows:** Create → Update → Delete\n**Auth:** qTest Bearer token (stored credential)\n**Notes:** Config-driven per ADO project",
        "height": 192,
        "width": 592,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        384,
        -768
      ],
      "id": "0339338e-89b8-4cde-bc34-8cde9f22ef12",
      "name": "Overview"
    },
    {
      "parameters": {
        "content": "## Webhook Node\n**Purpose:** Receive Azure DevOps service hooks\n**Type:** webhook (POST)\n**Path:** azure-dev-ops-task\n**Output:** raw webhook body (eventType + resource)\n**ResponseMode:** lastNode",
        "height": 192,
        "width": 256,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        400,
        -304
      ],
      "id": "d53e3153-71ea-41c0-a5d7-c0dd3ab14fdb",
      "name": "Webhook Note"
    },
    {
      "parameters": {
        "content": "## Load Configurations (JS)\n**Purpose:** Determine ADO project mapping\n**Output:** azureProjectName\n**Notes:** No credentials loaded here",
        "height": 128,
        "width": 320
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        -112
      ],
      "id": "c2b5815a-c659-4328-99fe-aba162f4566d",
      "name": "Config Selection"
    },
    {
      "parameters": {
        "content": "## Build Dynamic Payload (JS)\n**Purpose:** Build qTest payload + route info\n**Outputs in item.json:** { eventType, payload, qtest_url, qtest_project_id, workitem_id }\n**Used by:** Event Switch",
        "height": 144,
        "width": 336
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1008,
        -464
      ],
      "id": "b097a656-e7e8-4582-b477-f9098f9ac054",
      "name": "Build Payload Note"
    },
    {
      "parameters": {
        "content": "## Event Switch\n**Purpose:** Route by eventType → Created / Updated / Deleted\n**Inputs:** item.json.eventType\n**Outputs:** 3 branches",
        "height": 144,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1472,
        -480
      ],
      "id": "975cb750-0b98-4897-8881-9ef9e6f0e8fb",
      "name": "Event Switch Note"
    },
    {
      "parameters": {
        "content": "### Create Flow\n**Nodes:** Create-HTTP Request\n**Purpose:** POST requirement to qTest\n**Input:** payload from Build Dynamic Payload\n**Output:** created requirement response",
        "height": 128,
        "width": 336,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1856,
        -768
      ],
      "id": "b4d997eb-d2a7-420c-8f71-1736457b162a",
      "name": "Create Flow Note"
    },
    {
      "parameters": {
        "content": "### Update Flow\n**Sequence:** Search Req → Extract Req Id (JS) → Req Found? → Update-HTTP Request\n**Purpose:** Locate requirement by Azure_DevOps_ID, update fields if found",
        "height": 128,
        "width": 384,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1856,
        -432
      ],
      "id": "ecf233ae-2033-4f1a-a35e-f2f05e4a7467",
      "name": "Update Flow Note"
    },
    {
      "parameters": {
        "content": "### Delete Flow\n**Sequence:** Search Req → Extract Req Id (JS) → Req Found? → Delete-HTTP Request\n**Purpose:** Locate requirement by Azure_DevOps_ID and delete if present",
        "height": 128,
        "width": 384,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1872,
        -96
      ],
      "id": "36a6b74a-4aea-447b-b2f6-c6b588ee51e5",
      "name": "Delete Flow Note"
    },
    {
      "parameters": {
        "content": "## Credentials & Error Nodes\n**Credentials:** httpBearerAuth credential named 'Bearer Auth account'\n**Errors:** HTTP requests return JSON/text - consider adding error-handling or a Logger node for failures\n**Logs:** Successful and failed executions are being logged into a Google Sheet",
        "height": 192,
        "width": 336,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1008,
        -768
      ],
      "id": "67898664-21b5-427d-9911-a3a15c320958",
      "name": "Credentials & Errors"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.qtest_url }}/api/v3/projects/{{ $json.qtest_project_id }}/requirements",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "parentId",
              "value": "={{ $json.payload.parent_id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ \n  {\n    \"name\": $json.payload.name,\n    \"properties\": [\n      {\n        \"field_id\": $json.payload.properties[0].field_id,\n        \"field_name\": $json.payload.properties[0].field_name,\n        \"field_value\": $json.payload.properties[0].field_value\n      },\n      {\n        \"field_id\": $json.payload.properties[1].field_id,\n        \"field_name\": $json.payload.properties[1].field_name,\n        \"field_value\": $json.payload.properties[1].field_value\n      },\n      {\n        \"field_id\": $json.payload.properties[2].field_id,\n        \"field_name\": $json.payload.properties[2].field_name,\n        \"field_value\": $json.payload.properties[2].field_value\n      },\n      {\n        \"field_id\": $json.payload.properties[3].field_id,\n        \"field_name\": $json.payload.properties[3].field_name,\n        \"field_value\": $json.payload.properties[3].field_value\n      }\n    ]\n  }\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1856,
        -608
      ],
      "id": "de16820f-8470-4fb6-8d06-662880350b20",
      "name": "Create-HTTP Request",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "credentials": {
        "httpBearerAuth": {
          "id": "hueUfEaBjQGm54CR",
          "name": "Bearer Auth account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "={{ $('Event Switch').item.json.qtest_url }}/api/v3/projects/{{ $('Event Switch').item.json.qtest_project_id }}/requirements/{{ $json.requirementId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "parentId",
              "value": "={{ $('Event Switch').item.json.payload.parent_id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ \n  {\n    \"name\":$('Event Switch').item.json.payload.name,\n    \"properties\": [\n      {\n        \"field_id\": $('Event Switch').item.json.payload.properties[0].field_id,\n        \"field_name\": $('Event Switch').item.json.payload.properties[0].field_name,\n        \"field_value\": $('Event Switch').item.json.payload.properties[0].field_value\n      },\n      {\n        \"field_id\": $('Event Switch').item.json.payload.properties[1].field_id,\n        \"field_name\": $('Event Switch').item.json.payload.properties[1].field_name,\n        \"field_value\": $('Event Switch').item.json.payload.properties[1].field_value\n      },\n      {\n        \"field_id\": $('Event Switch').item.json.payload.properties[2].field_id,\n        \"field_name\": $('Event Switch').item.json.payload.properties[2].field_name,\n        \"field_value\": $('Event Switch').item.json.payload.properties[2].field_value\n      }\n    ]\n  }\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2720,
        -336
      ],
      "id": "4d01f4f9-fccb-4327-9170-424baa7ca8d1",
      "name": "Update-HTTP Request",
      "credentials": {
        "httpBearerAuth": {
          "id": "hueUfEaBjQGm54CR",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://office000test.qtestnet.com/api/v3/projects/23379/requirements/{{ $json.requirementId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "parentId",
              "value": "={{ $('Event Switch').item.json.payload.parent_id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2720,
        16
      ],
      "id": "695aa37d-261b-4fbd-9353-b460a14fd09d",
      "name": "Delete-HTTP Request",
      "credentials": {
        "httpBearerAuth": {
          "id": "hueUfEaBjQGm54CR",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.qtest_url }}/api/v3/projects/{{ $json.qtest_project_id }}/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"object_type\": \"requirements\",\n    \"fields\": [\n      \"id\" \n    ],\n    \"query\": \"'Azure_DevOps_ID' = {{ $json.workitem_id }}\"\n  }\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1872,
        64
      ],
      "id": "a08e6fe3-3559-4261-96b4-130625fa2e7e",
      "name": "Search Req-HTTP Request - Delete",
      "credentials": {
        "httpBearerAuth": {
          "id": "hueUfEaBjQGm54CR",
          "name": "Bearer Auth account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Extract requirement ID from search results\nconst searchResults = $input.first().json.items || [];\nconst httpResonse = $input.first().json;\n\nif(httpResonse.data){\n  return {\n    json: {\n      data: httpResonse.data,\n      dataFound: true,\n      error_message: httpResonse.data.trim(),\n      status_code: -1,\n      operation: \"searched_for_delete\",\n      original_data: {\n        eventType: $('Event Switch').first().json.eventType,\n        qtest_url: $('Event Switch').first().json.qtest_url,\n        qtest_project_id: $('Event Switch').first().json.qtest_project_id,\n        workitem_id: $('Event Switch').first().json.workitem_id,\n        attempts: $('Event Switch').first().json.retryCount,\n        projectName: $('Event Switch').first().json.projectName,\n      },\n      projectConfig: $('Event Switch').first().json.projectConfig\n    }\n  }\n}\n\nif (searchResults.length > 0) {\n  const requirement = searchResults[0];\n  \n  // Pass through both the requirement ID and the updated data from Azure DevOps\n  return {\n    json: {\n      requirementId: requirement.id,\n      found: true,\n      azureDevOpsData: $input.first().json.resource // Original Azure DevOps data\n    }\n  };\n} else {\n  return {\n    json: {\n      requirementId: null,\n      found: false,\n      azureDevOpsData: $input.first().json.resource\n    }\n  };\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2080,
        64
      ],
      "id": "93d514eb-417c-4d22-8f38-dbcfc1e64b1b",
      "name": "Extract Req Id - JS - Delete"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e76bf62f-ac20-4255-b4c1-f73d4054dd2d",
              "leftValue": "={{ $json.found }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2496,
        32
      ],
      "id": "56418fc8-dee4-412d-8097-eaf03a12f15e",
      "name": "Req Found? Delete"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.eventType }}",
                    "rightValue": "workItem.created",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e1965587-0695-430c-b5ce-ea78264b28ef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Created"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "78444353-6c2d-4f78-97e2-3276396b7e2c",
                    "leftValue": "={{ $json.eventType }}",
                    "rightValue": "workItem.updated",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Updated"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3905617e-1f34-4d92-8a17-0d21e424181e",
                    "leftValue": "={{ $json.eventType }}",
                    "rightValue": "workItem.deleted",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Deleted"
            }
          ]
        },
        "options": {
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1568,
        -304
      ],
      "id": "adbee44b-266e-4701-aa07-009762952ceb",
      "name": "Event Switch",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "multipleMethods": true,
        "httpMethod": [
          "POST"
        ],
        "path": "azure-dev-ops-task",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        720,
        -272
      ],
      "id": "54d6ab52-0a63-442e-91d2-1f5eb075e726",
      "name": "Event Webhook",
      "webhookId": "87b5a185-7ccd-495f-be6e-6ee2a1ad0da3",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.qtest_url }}/api/v3/projects/{{ $json.qtest_project_id }}/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"object_type\": \"requirements\",\n    \"fields\": [\n      \"id\" \n    ],\n    \"query\": \"'Azure_DevOps_ID' = {{ $json.workitem_id }}\"\n  }\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1856,
        -288
      ],
      "id": "a3ffc5f6-bbc5-45a5-96f3-a2efa39add8b",
      "name": "Search Req-HTTP Request - Update",
      "alwaysOutputData": false,
      "credentials": {
        "httpBearerAuth": {
          "id": "hueUfEaBjQGm54CR",
          "name": "Bearer Auth account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Extract requirement ID from search results\nconst searchResults = $input.first().json.items || [];\nconst httpResonse = $input.first().json;\n\nif(httpResonse.data){\n  return {\n    json: {\n      data: httpResonse.data,\n      dataFound: true,\n      error_message: httpResonse.data.trim(),\n      status_code: -1,\n      operation: \"searched_for_update\",\n      original_data: {\n        eventType: $('Event Switch').first().json.eventType,\n        qtest_url: $('Event Switch').first().json.qtest_url,\n        qtest_project_id: $('Event Switch').first().json.qtest_project_id,\n        workitem_id: $('Event Switch').first().json.workitem_id,\n        attempts: $('Event Switch').first().json.retryCount,\n        projectName: $('Event Switch').first().json.projectName,\n      },\n      projectConfig: $('Event Switch').first().json.projectConfig\n    }\n  }\n}\n\nif (searchResults.length > 0) {\n  const requirement = searchResults[0];\n  \n  // Pass through both the requirement ID and the updated data from Azure DevOps\n  return {\n    json: {\n      requirementId: requirement.id,\n      found: true,\n      azureDevOpsData: $input.first().json.resource // Original Azure DevOps data\n    }\n  };\n} else {\n  return {\n    json: {\n      requirementId: null,\n      found: false,\n      azureDevOpsData: $input.first().json.resource\n    }\n  };\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2128,
        -288
      ],
      "id": "7c46bdb8-93ad-4c80-ad88-62b73ce9f0ea",
      "name": "Extract Req Id - JS - Update"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e76bf62f-ac20-4255-b4c1-f73d4054dd2d",
              "leftValue": "={{ $json.found }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2512,
        -320
      ],
      "id": "af7f335c-af14-4c85-9fe4-4f2a2e53d930",
      "name": "Req Found? Update"
    },
    {
      "parameters": {
        "jsCode": "// Extract project information\nconst webhookData = $input.first().json.body;\n\nlet azureProjectName = \"\";\nif (webhookData.eventType===\"workitem.updated\") {\n  azureProjectName = webhookData.resource.revision.fields['System.TeamProject'] || \n                         webhookData.resourceContainers?.project?.name ||\n                         \"Unknown\";\n}else {\n  azureProjectName = webhookData.resource.fields['System.TeamProject'] || \n                         webhookData.resourceContainers?.project?.name ||\n                         \"Unknown\";\n}\n\n\n// Just identify the project, don't load credentials yet\nreturn {\n  json: {\n    webhookData: webhookData,\n    azureProjectName: azureProjectName,\n    eventType: webhookData.eventType\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        -272
      ],
      "id": "2d093ba4-8c33-4999-b4e8-473304063eca",
      "name": "Load Configurations - JS"
    },
    {
      "parameters": {
        "jsCode": "// Configuration for Project 1 ONLY\n// No credentials here - just field mappings\nconst config = {\n  \"nodeautomation\": { \n    qtest_project_id: 23379, \n    qtest_url: \"https://office000test.qtestnet.com\", \n    qtest_token_name: \"qTest demo Project API\", \n    field_mappings: { \n      description: 2272333, \n      azure_devops_id: 2274114, \n      ado_url: 2272414, \n      created_by: 2273528 \n    }, \n    parent_requirement_id: 5190560, \n    default_status: \"Draft\" \n  }, \n  \"FabrikamCloud\": { \n    qtest_project_id: 23514, \n    qtest_url: \"https://office000test.qtestnet.com\", \n    qtest_token: \"token_for_project2\", \n    field_mappings: { \n      description: 2285539, \n      azure_devops_id: 2285607, \n      ado_url: 2285602, \n      created_by: 2285600 \n    }, \n    parent_requirement_id: 5198870, \n    default_status: \"New\" \n  }\n};\n\n// Toggle manual error injection for testing\nconst simulateManualError = false; // Set to true for testing\nif (simulateManualError) {\n  throw new Error('Manual error injected for retry test!');\n}\n\nconst simulateInvalidUrl = true; // Set to true for URL error test\nif (simulateInvalidUrl) {\n  config[\"FabrikamCloud\"].qtest_url += '/INVALID_PATH_SEGMENT';\n}\n\n\n\n// Get webhook data\nconst webhookData = $input.first().json.webhookData;\nconst workItem = webhookData.resource;\nconst projectName = $input.first().json.azureProjectName;\nconst errorSim = $input.first().json.errorSimulation;\n\nif (!webhookData || !workItem || !projectName || projectName===''){\n  const now = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }).slice(0,19).replace(\"T\",\" \");\n  const qtest_project_id = (projectName && projectName!==\"\") ? config[projectName].qtest_project_id : -1;\n  const qtest_url = (projectName && projectName!==\"\") ? config[projectName].qtest_url : 'N/A';\n  const logFields = {\n    Timestamp: now,\n    Event_Type: webhookData.eventType || 'unknown',\n    Project_Name: projectName || 'N/A',\n    Work_Item_ID: workItem.id || workItem.workItemId || -1,\n    Operation: webhookData.eventType.split('.')[1] || 'N/A',\n    Error_Code: 'N/A',\n    Error_Message: 'Something bad happened while creating payload!',\n    Attempts: 0,\n    Status: 'ERROR',\n    qTest_Project_ID: qtest_project_id || -1,\n    qTest_URL: qtest_url || 'N/A'\n  };\n  \n  if (!workItem.fields?.['System.Title'] && !workItem.revision.fields?.['System.Title']) {\n    logFields.Error_Message = \"Missing title in Azure DevOps webhook payload\";\n  }\n  \n  // Append to Google Sheets (errors)\n  return { \n    json: {\n      error: true,\n      logFields\n    } \n  };\n}\n\n\n\nlet name = \"  \";\nlet desc = \"  \";\nlet workitemid = -1;\n\nif(webhookData.eventType===\"workitem.updated\"){\n  name = workItem.revision.fields[\"System.Title\"];\n  desc = workItem.revision.fields[\"System.Description\"];\n  workitemid = workItem.workItemId.toString() || -1;\n}else{\n  name = workItem.fields[\"System.Title\"];\n  desc = workItem.fields[\"System.Description\"];\n  workitemid = workItem.id;\n}\n\n// Build qTest payload\nconst qTestPayload = {\n  name: name || '  ', \n  parent_id: config[projectName].parent_requirement_id, \n  properties: [ \n    { \n      field_id: config[projectName].field_mappings.description, \n      field_name: \"Description\",\n      field_value: desc || '  '\n    }, \n    { \n      field_id: config[projectName].field_mappings.azure_devops_id, \n      field_name: \"Azure_DevOps_ID\",\n      field_value: workitemid\n    }, \n    { \n      field_id: config[projectName].field_mappings.ado_url, \n      field_name: \"ADO Link\",\n      field_value: workItem._links?.html?.href || \"https://dev.azure.com/\" \n    }, \n    { \n      field_id: config[projectName].field_mappings.created_by, \n      field_name: \"Created By\",\n      field_value: String(workItem.fields['System.CreatedBy']) || ''\n    } \n  ] \n};\n\n\n\nreturn {\n  json: {\n    error: false,\n    eventType: $input.first().json.eventType,\n    payload: qTestPayload,\n    qtest_url: config[projectName].qtest_url,\n    qtest_project_id: config[projectName].qtest_project_id,\n    workitem_id: workitemid,\n    errorSimulation: errorSim,\n    retryCount: $input.first().json.retryCount || 0,\n    projectName: projectName,\n    projectConfig: config\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1136,
        -272
      ],
      "id": "5442b5e1-4650-4e48-b431-3dd0987f6d92",
      "name": "Build Dynamic Payload - JS"
    },
    {
      "parameters": {
        "jsCode": "const now = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }).slice(0,19).replace(\"T\",\" \");\nconst data = $input.first().json;\nconst project = $('Event Switch').first().json.projectName || '';\nconst qtest_project_id = $('Event Switch').first().json.qtest_project_id || '';\nconst qtest_url = $input.first().json.original_data.links[0].href || '';\nreturn {\n  json: {\n    Timestamp: now,\n    Event_Type: data.operation || 'unknown',\n    Project_Name: project,\n    Work_Item_ID: $('Event Switch').first().json.workitem_id || '',\n    Operation: data.operation || '',\n    Attempts: data.attempts || 1,\n    Status: 'SUCCESS',\n    qTest_Requirement_ID: $input.first().json.qtest_requirement_id || '',\n    qTest_Project_ID: qtest_project_id,\n    req_parent_id: $input.first().json.original_data.parent_id || '',\n    qTest_requirement_URL: qtest_url\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2448,
        -720
      ],
      "id": "de174e7c-3cee-465b-8055-fe66678d7c20",
      "name": "Success Logging Node"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10",
          "mode": "list",
          "cachedResultName": "ADO-qTest Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 829971239,
          "mode": "list",
          "cachedResultName": "Errors",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit#gid=829971239"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.Timestamp }}",
            "Event Type": "={{ $json.Event_Type }}",
            "Project Name": "={{ $json.Project_Name }}",
            "Work Item ID": "={{ $json.Work_Item_ID }}",
            "Operation": "={{ $json.Operation }}",
            "Error Code": "={{ $json.Error_Code }}",
            "Error Message": "={{ $json.Error_Message }}",
            "Attempts": "={{ $json.Attempts }}",
            "Status": "={{ $json.Status }}",
            "qTest Project ID": "={{ $json.qTest_Project_ID }}",
            "qTest URL": "={{ $json.qTest_URL }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Event Type",
              "displayName": "Event Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Project Name",
              "displayName": "Project Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Work Item ID",
              "displayName": "Work Item ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Operation",
              "displayName": "Operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Code",
              "displayName": "Error Code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Message",
              "displayName": "Error Message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Attempts",
              "displayName": "Attempts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest Project ID",
              "displayName": "qTest Project ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest URL",
              "displayName": "qTest URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2656,
        -544
      ],
      "id": "71ecc7ce-22e1-48af-9337-541161a5dc2d",
      "name": "Add Failure Logs to Worksheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IyK1i0zXcdUKePIG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10",
          "mode": "list",
          "cachedResultName": "ADO-qTest Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sucesses",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.Timestamp }}",
            "Event Type": "={{ $json.Event_Type }}",
            "Project Name": "={{ $json.Project_Name }}",
            "Work Item ID": "={{ $json.Work_Item_ID }}",
            "Operation": "={{ $json.Operation }}",
            "Requirement ID": "={{ $json.qTest_Requirement_ID }}",
            "Requirement Parent ID": "={{ $json.req_parent_id }}",
            "Attempts": "={{ $json.Attempts }}",
            "Status": "={{ $json.Status }}",
            "qTest Project ID": "={{ $json.qTest_Project_ID }}",
            "qTest Requirement URL": "={{ $json.qTest_requirement_URL }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Event Type",
              "displayName": "Event Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Project Name",
              "displayName": "Project Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Work Item ID",
              "displayName": "Work Item ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Operation",
              "displayName": "Operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Requirement ID",
              "displayName": "Requirement ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Requirement Parent ID",
              "displayName": "Requirement Parent ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Attempts",
              "displayName": "Attempts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest Project ID",
              "displayName": "qTest Project ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest Requirement URL",
              "displayName": "qTest Requirement URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2656,
        -720
      ],
      "id": "eb841b57-0fb8-4d22-b01f-4b1f8d27451f",
      "name": "Add Success Logs to Worksheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IyK1i0zXcdUKePIG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Check if HTTP request succeeded or failed\n\nconst httpResponse = $input.first().json;\nconst previousData = $input.item.json;\n\n// Check if response indicates success\nconst isSuccess = !httpResponse.error && !httpResponse.data && httpResponse.id;\n\nif (isSuccess) {\n  console.log('✅ Successfully created requirement:', httpResponse.id);\n  \n  return {\n    json: {\n      success: true,\n      operation: 'create',\n      azure_work_item_id: previousData.azure_work_item_id,\n      qtest_requirement_id: httpResponse.id,\n      qtest_requirement_name: httpResponse.name,\n      attempts: previousData.retryCount + 1 || 1,\n      original_data: previousData\n    }\n  };\n} else {\n  // Extract error details\n  let errorMessage;\n  if (!httpResponse.data) {\n    \n  errorMessage = httpResponse.error?.message || \n                      httpResponse.message || \n                      'Unknown error occurred';\n  }else{\n    errorMessage = httpResponse.data;\n  }\n  \n  const statusCode = httpResponse.statusCode || \n                     !httpResponse.data ? httpResponse.error.status : -1 || \n                    500;\n  \n  console.log('❌ HTTP Request failed');\n  console.log('Status Code:', statusCode);\n  console.log('Error:', errorMessage);\n  \n  // Determine if error is retryable\n  const retryableErrors = [429, 500, 502, 503, 504];\n  const isRetryable = retryableErrors.includes(statusCode) || \n                     errorMessage.includes('ETIMEDOUT') ||\n                     errorMessage.includes('ECONNREFUSED') ||\n                     errorMessage.includes('ENOTFOUND');\n\n  let errorMsg = \"\";\n  // Parse the JSON string into a JavaScript object\n  if(!httpResponse.data){\n    try {\n      const match = errorMessage.match(/\\{.*\\}/); \n      if (match && match[0]) {\n        // match[0] contains ONLY the content inside the parentheses (the clean JSON string)\n        const jsonString = match[0]; \n        const cleanedJsonString = JSON.parse(`\"${jsonString}\"`);\n        const errorData = JSON.parse(cleanedJsonString);\n  \n        // Extract the required fields and make error message\n        errorMsg = `${errorData.title} - ${errorData.message}`;\n          \n      }\n    \n    } catch (e) {\n      errorMsg = errorMessage\n    }\n  }else {errorMsg = errorMessage.trim();}\n  \n  return {\n    json: {\n      success: false,\n      error: true,\n      operation: 'created',\n      error_message: errorMsg,\n      status_code: statusCode,\n      status: !httpResponse.data ? httpResponse.error.code : -1 || 'ERROR',\n      is_retryable: isRetryable,\n      retry_count: previousData.retryCount || 0,\n      max_retries: previousData.errorSimulation?.MAX_RETRIES || 3,\n      azure_work_item_id: previousData.azure_work_item_id,\n      original_data: previousData\n    }\n  };\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2048,
        -608
      ],
      "id": "d820c9a2-0c26-4674-b913-b2c9c42ee557",
      "name": "Check For Response Status"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f1aaa92d-3fb5-4959-98de-2b592899c88e",
              "leftValue": "={{ $json.success }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2240,
        -608
      ],
      "id": "2989682c-a172-42b1-94c9-84917903f822",
      "name": "If success or failed?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a0b27ed8-4e41-47a4-8c6c-2ee55425d834",
              "leftValue": "={{ $json.error }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1328,
        -272
      ],
      "id": "46563565-bb2a-4d22-862d-fc9af9e9d5ae",
      "name": "is payload created successfully?"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10",
          "mode": "list",
          "cachedResultName": "ADO-qTest Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 829971239,
          "mode": "list",
          "cachedResultName": "Errors",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit#gid=829971239"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.logFields.Timestamp }}",
            "Event Type": "={{ $json.logFields.Event_Type }}",
            "Project Name": "={{ $json.logFields.Project_Name }}",
            "Work Item ID": "={{ $json.logFields.Work_Item_ID }}",
            "Operation": "={{ $json.logFields.Operation }}",
            "Error Code": "={{ $json.logFields.Error_Code }}",
            "Error Message": "={{ $json.logFields.Error_Message }}",
            "Attempts": "={{ $json.logFields.Attempts }}",
            "Status": "={{ $json.logFields.Status }}",
            "qTest Project ID": "={{ $json.logFields.qTest_Project_ID }}",
            "qTest URL": "={{ $json.logFields.qTest_URL }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Event Type",
              "displayName": "Event Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Project Name",
              "displayName": "Project Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Work Item ID",
              "displayName": "Work Item ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Operation",
              "displayName": "Operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Code",
              "displayName": "Error Code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Message",
              "displayName": "Error Message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Attempts",
              "displayName": "Attempts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest Project ID",
              "displayName": "qTest Project ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest URL",
              "displayName": "qTest URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1584,
        -80
      ],
      "id": "a128eecf-41ec-45fe-b240-0dd2efae55a3",
      "name": "Log payload creation failed",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IyK1i0zXcdUKePIG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const now = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }).slice(0,19).replace(\"T\",\" \");\nconst data = $input.first().json;\nconst project = data.original_data.projectConfig?.azure_project_name || data.original_data.projectName || '';\nconst qtest_project_id = !data.original_data.data ? data.original_data.qtest_project_id : -1 || '';\nconst qtest_url = !data.original_data.data ? data.original_data.qtest_url : \"N/A\" || data.qtest_url || '';\nconst msg = data.error_message || \"\";\n\nreturn {\n  json: {\n    Timestamp: now,\n    Event_Type: $('Event Switch').first().json.eventType || 'unknown',\n    Project_Name: project!== \"\" ? project : 'N/A',\n    Work_Item_ID: data.original_data.workitem_id || -1,\n    Operation: data.operation || '',\n    Error_Code: data.status_code || '',\n    Error_Message: msg,\n    Attempts: data.attempts || data.retry_count || 0,\n    Status: data.status || 'ERROR',\n    qTest_Requirement_ID: !data.original_data.data ? data.original_data.workitem_id : -1 || '',\n    qTest_Project_ID: qtest_project_id,\n    qTest_URL: qtest_url\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2448,
        -544
      ],
      "id": "b454ac88-bc27-4ad1-a9da-79c9cfdf35c2",
      "name": "Error Logging Node - Create"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e98950de-81fe-4230-82a3-8bd6a876da77",
              "leftValue": "={{ $json.dataFound }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2304,
        -288
      ],
      "id": "12794620-4a50-4ac4-bfaf-a93373c9fa1a",
      "name": "Is search succeeded? Update"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "850691c9-0a9a-4688-add9-d397b95287a3",
              "leftValue": "={{ $json.dataFound }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2288,
        64
      ],
      "id": "d243cc89-47bf-4658-9dd5-648341cd0c76",
      "name": "Is search succeeded? Delete"
    },
    {
      "parameters": {
        "jsCode": "const now = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }).slice(0,19).replace(\"T\",\" \");\nconst data = $input.first().json;\nconst project = data.original_data.projectConfig?.azure_project_name || data.original_data.projectName || '';\nconst qtest_project_id = !data.original_data.data ? data.original_data.qtest_project_id : -1 || '';\nconst qtest_url = !data.original_data.data ? data.original_data.qtest_url : \"N/A\" || data.qtest_url || '';\nconst msg = data.error_message || \"\";\n\nreturn {\n  json: {\n    Timestamp: now,\n    Event_Type: $input.first().json.original_data.eventType || 'unknown',\n    Project_Name: project!== \"\" ? project : 'N/A',\n    Work_Item_ID: data.original_data.workitem_id || -1,\n    Operation: data.operation || '',\n    Error_Code: data.status_code || '',\n    Error_Message: msg,\n    Attempts: data.attempts || data.retry_count || 0,\n    Status: data.status || 'ERROR',\n    qTest_Requirement_ID: !data.original_data.data ? data.original_data.workitem_id : -1 || '',\n    qTest_Project_ID: qtest_project_id,\n    qTest_URL: qtest_url\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2512,
        -160
      ],
      "id": "2c13e101-28cc-4438-a7ad-edc1a72bd551",
      "name": "Error Logging Node - Search-Update"
    },
    {
      "parameters": {
        "jsCode": "const now = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }).slice(0,19).replace(\"T\",\" \");\nconst data = $input.first().json;\nconst project = data.original_data.projectConfig?.azure_project_name || data.original_data.projectName || '';\nconst qtest_project_id = !data.original_data.data ? data.original_data.qtest_project_id : -1 || '';\nconst qtest_url = !data.original_data.data ? data.original_data.qtest_url : \"N/A\" || data.qtest_url || '';\nconst msg = data.error_message || \"\";\n\nreturn {\n  json: {\n    Timestamp: now,\n    Event_Type: $input.first().json.original_data.eventType || 'unknown',\n    Project_Name: project!== \"\" ? project : 'N/A',\n    Work_Item_ID: data.original_data.workitem_id || -1,\n    Operation: data.operation || '',\n    Error_Code: data.status_code || '',\n    Error_Message: msg,\n    Attempts: data.attempts || data.retry_count || 0,\n    Status: data.status || 'ERROR',\n    qTest_Requirement_ID: !data.original_data.data ? data.original_data.workitem_id : -1 || '',\n    qTest_Project_ID: qtest_project_id,\n    qTest_URL: qtest_url\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2496,
        192
      ],
      "id": "057c969f-916d-4cb2-81a6-4c6e98d46e44",
      "name": "Error Logging Node - Search-Delete"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10",
          "mode": "list",
          "cachedResultName": "ADO-qTest Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 829971239,
          "mode": "list",
          "cachedResultName": "Errors",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit#gid=829971239"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.Timestamp }}",
            "Event Type": "={{ $json.Event_Type }}",
            "Project Name": "={{ $json.Project_Name }}",
            "Work Item ID": "={{ $json.Work_Item_ID }}",
            "Operation": "={{ $json.Operation }}",
            "Error Code": "={{ $json.Error_Code }}",
            "Error Message": "={{ $json.Error_Message }}",
            "Attempts": "={{ $json.Attempts }}",
            "Status": "={{ $json.Status }}",
            "qTest Project ID": "={{ $json.qTest_Project_ID }}",
            "qTest URL": "={{ $json.qTest_URL }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Event Type",
              "displayName": "Event Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Project Name",
              "displayName": "Project Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Work Item ID",
              "displayName": "Work Item ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Operation",
              "displayName": "Operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Code",
              "displayName": "Error Code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Message",
              "displayName": "Error Message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Attempts",
              "displayName": "Attempts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest Project ID",
              "displayName": "qTest Project ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest URL",
              "displayName": "qTest URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2704,
        192
      ],
      "id": "9735ed29-1a36-43d6-9caa-cb07242d2ac6",
      "name": "Add Req Search Error Log - Delete",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IyK1i0zXcdUKePIG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10",
          "mode": "list",
          "cachedResultName": "ADO-qTest Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 829971239,
          "mode": "list",
          "cachedResultName": "Errors",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1BMQqMpBQ3M3tDj_yXCMqF0ZtFtQvxCh7Q8dXEVW2O10/edit#gid=829971239"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.Timestamp }}",
            "Event Type": "={{ $json.Event_Type }}",
            "Project Name": "={{ $json.Project_Name }}",
            "Work Item ID": "={{ $json.Work_Item_ID }}",
            "Operation": "={{ $json.Operation }}",
            "Error Code": "={{ $json.Error_Code }}",
            "Error Message": "={{ $json.Error_Message }}",
            "Attempts": "={{ $json.Attempts }}",
            "Status": "={{ $json.Status }}",
            "qTest Project ID": "={{ $json.qTest_Project_ID }}",
            "qTest URL": "={{ $json.qTest_URL }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Event Type",
              "displayName": "Event Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Project Name",
              "displayName": "Project Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Work Item ID",
              "displayName": "Work Item ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Operation",
              "displayName": "Operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Code",
              "displayName": "Error Code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Error Message",
              "displayName": "Error Message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Attempts",
              "displayName": "Attempts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest Project ID",
              "displayName": "qTest Project ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "qTest URL",
              "displayName": "qTest URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2720,
        -160
      ],
      "id": "14b2509c-df39-4de8-9598-481cd14b95e4",
      "name": "Add Req Search Error Log - Update",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IyK1i0zXcdUKePIG",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Create-HTTP Request": {
      "main": [
        [
          {
            "node": "Check For Response Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check For Response Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Req-HTTP Request - Delete": {
      "main": [
        [
          {
            "node": "Extract Req Id - JS - Delete",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Req Id - JS - Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Req Id - JS - Delete": {
      "main": [
        [
          {
            "node": "Is search succeeded? Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Req Found? Delete": {
      "main": [
        [
          {
            "node": "Delete-HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Event Switch": {
      "main": [
        [
          {
            "node": "Create-HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search Req-HTTP Request - Update",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search Req-HTTP Request - Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Event Webhook": {
      "main": [
        [
          {
            "node": "Load Configurations - JS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Req-HTTP Request - Update": {
      "main": [
        [
          {
            "node": "Extract Req Id - JS - Update",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Req Id - JS - Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Req Id - JS - Update": {
      "main": [
        [
          {
            "node": "Is search succeeded? Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Req Found? Update": {
      "main": [
        [
          {
            "node": "Update-HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Load Configurations - JS": {
      "main": [
        [
          {
            "node": "Build Dynamic Payload - JS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Dynamic Payload - JS": {
      "main": [
        [
          {
            "node": "is payload created successfully?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Success Logging Node": {
      "main": [
        [
          {
            "node": "Add Success Logs to Worksheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check For Response Status": {
      "main": [
        [
          {
            "node": "If success or failed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If success or failed?": {
      "main": [
        [
          {
            "node": "Success Logging Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Logging Node - Create",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "is payload created successfully?": {
      "main": [
        [
          {
            "node": "Event Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log payload creation failed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Logging Node - Create": {
      "main": [
        [
          {
            "node": "Add Failure Logs to Worksheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is search succeeded? Update": {
      "main": [
        [
          {
            "node": "Req Found? Update",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Logging Node - Search-Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is search succeeded? Delete": {
      "main": [
        [
          {
            "node": "Req Found? Delete",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Logging Node - Search-Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Logging Node - Search-Update": {
      "main": [
        [
          {
            "node": "Add Req Search Error Log - Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Logging Node - Search-Delete": {
      "main": [
        [
          {
            "node": "Add Req Search Error Log - Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "53279ae1-7b5c-4f37-968b-08c58c273c0c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "59d808ce783ad80b8e9cb2b54575e1ad01ae3f95cf1d9d70bcf16abc94fc8c3e"
  },
  "id": "aj3DnxBXRRQvKaBe",
  "tags": []
}